---
title: String字符串有没有上限
date: 2021-04-01 21:22:47
tags: Java
categories: 日常学习
---

String字符串到底有没有上限呢？我们通过源码来分析。

**首先**，我们需要知道String字符串实际是用什么存储的，在jdk1.6中，String是用byte数组存储的，在jdk1.8中，String是用char[]存储的。

数组，我们是需要可以设置大小的，数组设置大小有两种方法：

```java
char[] arr = new char[12]; //数组长度为12
char[] ar = {1,2,3,4,5};   //数组长度为5
```

其中，数组长度的定义都为整数，至于为什么是整数类型，我们可以看一下length()这个方法，该方法的返回值是int类型，所以数组长度不可能超过int类型的上限，我们通过Integer的代码中可以看到：

<!-- more -->

```
int maxValue = Integer.MAX_VALUE;
//查看MAX_VALUE的源码
```

![image-20210401230126446](https://aaaas.oss-cn-beijing.aliyuncs.com/image-20210401230126446.png)

注释中写道，int的最大值为2^31-1也就是2147483647 = 4GB。

所以String的最大长度应该是2147483647，但是，我们测试一下，创建一个十万个字节长的字符串，使用String a = "";方式来创建，编译后，jvm报错，提示原因是，字符串长度过长，为什么会这样呢？由此引出了下面的问题，String创建的两种方式。

String字符串有两种创建方式，分别为：

```java
String a = "adasdsdasd";
String s = new String("asdasda");
```

这两种创建方式存储的地方是不一样的，字符串a创建后，会存储在常量池中，而字符串s则被存储在堆内存中。

**存储在常量池：**

常量池中数组的有效长度为0-65535，但是虚拟机还需要一个字节的指令作为结束，所以真正的有效范围为0~65534（至于为什么是这个范围，本文不做解释，后续文章会有所解释），也就是说，通过。

```java
String a = "";
```

创建的字符串，因为是一个常量，所以会被存储在常量池中，存储在常量池的话，就需要被常量池的规则约束，上限为65534个字节的长度，如果拼接字符串的话则不需要遵守这个约束，因为拼接后是一个对象，存储在堆内存中。

**存储在堆内存：**

```java
String a = new String("asdasda");
```

因为a字符串是new出来的，所以是一个对象，所以它的值会被存储在堆内存中，在堆内存中的字符串则不需要遵守常量池的约束可以达到整型的最大值。

**结论**

当字符串在常量池中时，上限为65534。

当字符串为拼接，或者扶着的话范围为整形的最大值。